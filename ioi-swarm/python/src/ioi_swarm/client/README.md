# `ioi_swarm.client`

This module implements the **gRPC Client** responsible for communication between the Python Agent SDK and the local IOI Kernel node (`ioi-local`).

It serves as the transport layer for the **Agency Firewall**, ensuring that every tool execution is cryptographically signed, submitted to the blockchain, and verified against active security policies before it occurs.

## Key Features

*   **gRPC Transport:** Connects to the `PublicApi` service exposed by the IOI Orchestrator (default port `9000`).
*   **Deterministic Serialization:** Implements **RFC 8785 (JCS)** to canonicalize JSON payloads. This ensures that the hash of an action generated by the Python SDK matches the hash computed by the Rust Kernel, which is critical for signature verification and policy enforcement (Whitepaper ยง5.3).
*   **Transaction Lifecycle:** Handles submission (`submit_action`) and status polling (`wait_for_commit`).

## Usage

While this client is primarily used internally by the `@tool` decorator, it can be instantiated directly for custom integrations or advanced control flow.

```python
from ioi_swarm.client import IoiClient
from ioi_swarm.types import ActionRequest, ActionTarget, ActionContext

# 1. Connect to the local node
client = IoiClient(address="127.0.0.1:9000")

# 2. Define an action request manually
# (Usually done automatically by @tool)
req = ActionRequest(
    target=ActionTarget.NET_FETCH,
    params=b'{"url": "https://example.com"}', # Must be canonical JSON bytes
    context=ActionContext(agent_id="manual_test"),
    nonce=1
)

# 3. Submit to Kernel
tx_hash = client.submit_action(req)
print(f"Action submitted. Hash: {tx_hash}")

# 4. Wait for block inclusion (optional)
try:
    status = client.wait_for_commit(tx_hash)
    print("Action successfully committed to the chain.")
except Exception as e:
    print(f"Action failed or timed out: {e}")
```

## API Reference

### `class IoiClient`

#### `__init__(address: str = "0.0.0.0:9000")`
Establishes a gRPC channel to the specified IOI Node address.

#### `submit_action(request: ActionRequest, signer_key: Optional[str] = None) -> str`
Submits an `ActionRequest` to the Kernel.
*   **`request`**: The typed action object containing target, parameters, and context.
*   **`signer_key`**: (Optional) Private key for signing. In local mode, the node often handles signing via the Guardian.
*   **Returns**: The Transaction Hash (`tx_hash`) as a hex string.

#### `wait_for_commit(tx_hash: str, timeout: float = 5.0)`
Blocks until the specified transaction is included in a block or the timeout is reached.
*   **`tx_hash`**: The hash returned by `submit_action`.
*   **`timeout`**: Max seconds to wait.
*   **Returns**: The transaction status object from the node.
*   **Raises**: `TimeoutError` or `Exception` if rejected.