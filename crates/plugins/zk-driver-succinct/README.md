# IOI ZK Driver: Succinct (SP1)

This crate provides the **Zero-Knowledge Proof (ZKP) Driver** implementation for the IOI Kernel, leveraging the **SP1 ZKVM** by Succinct Labs.

It serves as the interface between the IOI Kernel's abstract verification traits (`IbcZkVerifier`, `AgentZkVerifier`) and the concrete SP1 proving system. This enables the kernel to verify:

1.  **Bridgeless IBC**: Verifying Ethereum Beacon Chain updates and storage proofs without a multisig.
2.  **Verifiable Inference**: Proving that an AI model executed correctly on specific input data (Semantic Integrity).

## Features

### Hybrid Verification Mode
The driver operates in two modes, controlled by the `native` feature flag:

*   **Mock Mode (Default)**:
    *   Used for fast local development and CI tests where generating real SNARKs is too slow.
    *   Simulates verification by checking `hash(proof) == hash(public_inputs)`.
    *   **Security**: ZERO. Do not use in production.

*   **Native Mode (`--features native`)**:
    *   Uses the real `sp1-verifier` crate.
    *   Performs cryptographic verification of Groth16 proofs generated by the SP1 prover.
    *   Requires the correct Verification Keys (VK) to be loaded from configuration.

### Supported Circuits

The driver currently supports verification logic for:

1.  **Beacon Update**: Verifies the transition of the Ethereum Beacon Chain light client (sync committee signature verification).
2.  **State Inclusion**: Verifies Merkle-Patricia Trie (MPT) inclusion proofs against a trusted state root.
3.  **Agentic Inference**: (Experimental) Verifies that `Output = Model(Input)` for a specific model hash.

## Architecture

The driver is instantiated with a `SuccinctDriverConfig` which contains the Verification Keys (VKs) for the supported circuits. These VKs act as the "Trust Anchor" â€“ the kernel trusts any proof that validates against these keys.

### Module Structure

*   `src/lib.rs`: Main entry point. Implements `IbcZkVerifier` and `AgentZkVerifier`.
*   `src/config.rs`: Configuration struct for loading VKs.
*   `src/sp1_backend.rs`: Integration with `sp1-verifier` (only compiled when `native` feature is active).
*   `tests/`: Integration tests using pre-generated fixtures.

## Usage

### Instantiation

```rust
use zk_driver_succinct::{SuccinctDriver, config::SuccinctDriverConfig};

// For development
let mock_driver = SuccinctDriver::new_mock();

// For production (requires VKs)
let config = SuccinctDriverConfig {
    beacon_vkey_hash: "0x...",
    beacon_vkey_bytes: vec![...],
    state_inclusion_vkey_hash: "0x...",
    state_inclusion_vkey_bytes: vec![...],
};
let real_driver = SuccinctDriver::new(config);
```

### Verification Example (IBC)

```rust
// Verify an Ethereum Beacon Header update
driver.verify_beacon_update(&proof_bytes, &public_inputs)?;

// Verify a storage slot value
driver.verify_state_inclusion(
    StateProofScheme::Mpt,
    &proof_bytes, 
    trusted_state_root
)?;
```

## Testing

The crate includes a robust test suite in `src/tests`.

To run tests with the **Real** verifier (requires fixtures generated by `ioi-test-utils`):

```bash
cargo test -p zk-driver-succinct --features native
```

To generate the required ZK fixtures (requires `sp1` installed):

```bash
cargo run -p ioi-test-utils --bin generate_zk_fixtures --features zk-gen
```